#!/bin/bash

set -e

DIR=$(readlink -f $1)
DATE=$(basename $DIR)
BENCH=$(basename $(dirname $DIR))
# LABEL=isaac-demo-$BENCH-$DATE

echo DIR=$DIR DATE=$DATE BENCH=$BENCH

FINAL=${FINAL:-0}
PRELIM=${PRELIM:-0}
FILTERED=${FILTERED:-0}

if [[ "$FINAL" == "1" ]]
then
    STAGE="final"
elif [[ "$PRELIM" == "1" ]]
then
    STAGE="prelim"
elif [[ "$FILTERED" == "1" ]]
then
    STAGE="filtered"
else
    STAGE="default"
fi
STAGE_DIR=$DIR/$STAGE

# RUN=$STAGE_DIR/run
# SESS=$STAGE_DIR/sess
WORK=$STAGE_DIR/work
INDEX_FILE=$WORK/index.yml

# RUNTIME_WEIGHT=${RUNTIME_WEIGHT:-1.0}
# CODE_SIZE_WEIGHT=${CODE_SIZE_WEIGHT:-1.0}
ENC_WEIGHT=${ENC_WEIGHT:-1.0}
UTIL_WEIGHT=${UTIL_WEIGHT:-1.0}

# --runtime-weight $RUNTIME_WEIGHT --code-size_weight $CODE_SIZE_WEIGHT
python3 scripts/annotate_score.py $INDEX_FILE --inplace --prelim --util-weight $UTIL_WEIGHT --enc-weight $ENC_WEIGHT
